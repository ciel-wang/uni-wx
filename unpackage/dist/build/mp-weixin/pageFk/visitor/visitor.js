require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pageFk/visitor/visitor"],{"0269":function(e,t,i){},"10a4":function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){return o}));var o={uIcon:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(i.bind(null,"1e79"))},uForm:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-form/u-form")]).then(i.bind(null,"ff33"))},myCard:function(){return i.e("components/my-card").then(i.bind(null,"2227"))},uImage:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-image/u-image")]).then(i.bind(null,"a083"))},myUpload:function(){return Promise.all([i.e("common/vendor"),i.e("components/my-upload")]).then(i.bind(null,"efc5"))},uFormItem:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(i.bind(null,"f4f7"))},uInput:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-input/u-input")]).then(i.bind(null,"f18a"))},uRadioGroup:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-radio-group/u-radio-group")]).then(i.bind(null,"9f38"))},uRadio:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-radio/u-radio")]).then(i.bind(null,"082a"))},"u-Textarea":function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u--textarea/u--textarea")]).then(i.bind(null,"433b"))},uSwipeAction:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-swipe-action/u-swipe-action")]).then(i.bind(null,"68f0"))},uSwipeActionItem:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-swipe-action-item/u-swipe-action-item")]).then(i.bind(null,"b9de"))},myButton:function(){return i.e("components/my-button").then(i.bind(null,"e84c"))},uActionSheet:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-action-sheet/u-action-sheet")]).then(i.bind(null,"ff2a"))},wPicker:function(){return i.e("components/w-picker/w-picker").then(i.bind(null,"c33c"))},uKeyboard:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-keyboard/u-keyboard")]).then(i.bind(null,"1a2a"))},uOverlay:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-overlay/u-overlay")]).then(i.bind(null,"3776"))},uToast:function(){return i.e("uni_modules/uview-ui/components/u-toast/u-toast").then(i.bind(null,"b688"))}},r=function(){var e=this,t=e.$createElement,i=(e._self._c,e.imgBase64.length),o=e.isShowCertificate&&e.certificateUrl.length>0,r=e.isShowCertificate&&0===e.certificateUrl.length,n=e.visitHistory.length,s=n>0?e.__map(e.visitHistory,(function(t,i){var o=e.__get_orig(t),r=e.$u.guid();return{$orig:o,g4:r}})):null;e._isMounted||(e.e0=function(t){e.certificateTypeShow=!0},e.e1=function(t){e.sourceAdrShow=!0},e.e2=function(t){e.keyboardCarShow=!0},e.e3=function(t){e.keyboardNumShow=!0},e.e4=function(t){e.certificateTypeShow=!1},e.e5=function(t){e.keyboardCarShow=!1},e.e6=function(t){e.keyboardCarShow=!1},e.e7=function(t){e.keyboardNumShow=!1},e.e8=function(t){e.keyboardNumShow=!1}),e.$mp.data=Object.assign({},{$root:{g0:i,g1:o,g2:r,g3:n,l0:s}})},n=[]},"46f0":function(e,t,i){"use strict";i.r(t);var o=i("6c5d"),r=i.n(o);for(var n in o)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(n);t["default"]=r.a},"4fa8":function(e,t,i){"use strict";(function(e,t){var o=i("4ea4");i("5495");o(i("66fd"));var r=o(i("6a06"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(r.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},"6a06":function(e,t,i){"use strict";i.r(t);var o=i("10a4"),r=i("46f0");for(var n in r)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(n);i("e43b");var s=i("f0c5"),u=Object(s["a"])(r["default"],o["b"],o["c"],!1,null,"52bbcd7e",null,!1,o["a"],void 0);t["default"]=u.exports},"6c5d":function(e,t,i){"use strict";(function(e){var o=i("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(i("448a")),n=o(i("9523")),s=o(i("3cda")),u=i("c358");function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function c(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){(0,n.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var l={components:{wPicker:function(){i.e("components/w-picker/w-picker").then(function(){return resolve(i("c33c"))}.bind(null,i)).catch(i.oe)}},data:function(){var e=this;return{form:{goodsNum:"",visitorSex:1,note:""},fileHeader:{token:"",appId:"",sid:""},showProgress:!0,rules:{visitorName:[{required:!0,message:"请填写来访人员姓名",trigger:"blur"}],visitorPhone:[{validator:function(t,i,o){return e.$u.test.mobile(i)},message:"手机号码不正确",trigger:"blur"}],certificateType:[{required:!0,message:"请选择证件类型",trigger:["blur","change"]}],visitorCertificateCode:[{required:!0,message:"请输入证件编号",trigger:"blur"}]},visitHistory:[],imgBase64:"",visitForm:[],applyForm:{},options:[{text:"删除",style:{backgroundColor:"#dd524d",width:"150rpx"}}],keyboardCarShow:!1,visitorCarNumVal:"",maskShow:!1,maskImgShow:!1,CodeAction:"".concat(s.default.baseUrl,"/iot-wx/commons/upload"),goodsAction:"".concat(s.default.baseUrl,"/iot-wx/visitor/goods/upload/pic"),keyboardNumShow:!1,goodsFileList:[],goodsList:[],errText:"",sourceAdrShow:!1,sourceAdrDic:(0,u.city)(),isShowSourceAddr:!0,isShowCertificate:!0,certificateTypeShow:!1,certificateTypeDic:[{value:"身份证",name:"身份证"},{value:"军官证",name:"军官证"},{value:"驾驶证",name:"驾驶证"},{value:"港澳通行证",name:"港澳通行证"},{value:"台胞证",name:"台胞证"},{value:"护照",name:"护照"},{value:"其他",name:"其他"}],certificateUrl:""}},onReady:function(){this.fileHeader.appId=this.vuex_urlobj.appId,this.fileHeader.token=this.vuex_urlobj.token,this.fileHeader.sid=this.vuex_urlobj.sid},onLoad:function(){var t,i,o=this;this.isShowSourceAddr=1==(null===(t=this.vuex_cfg)||void 0===t?void 0:t.isShowSourceAddr),this.isShowCertificate=1==(null===(i=this.vuex_cfg)||void 0===i?void 0:i.isShowCertificate),this.isShowSourceAddr?this.$nextTick((function(){return o.$refs.uForm.setRules(c(c({},o.rules),{},{sourceAddress:[{required:!0,message:"请选择来源地",trigger:["change","blur"]}]}))})):this.$nextTick((function(){return o.$refs.uForm.setRules(o.rules)})),e.getStorageSync("visitHistory_key")&&(this.visitHistory=e.getStorageSync("visitHistory_key")),e.getStorageSync("applyForm_key")&&(this.applyForm=e.getStorageSync("applyForm_key"),this.applyForm.visitForm&&(this.visitForm=this.applyForm.visitForm))},methods:{imageClick:function(t){e.previewImage({urls:[t]})},handlerOCR:function(){var t=this;e.chooseImage({success:function(i){t.maskShow=!0,e.uploadFile({url:"".concat(s.default.baseUrl,"/iot-wx/commons/idcard/ocr/recognition"),name:"file",filePath:i.tempFilePaths[0],success:function(e){var i=JSON.parse(e.data);t.maskShow=!1,200==i.code&&i.data.idCardNo?(t.$set(t.form,"visitorCertificateCode",i.data.idCardNo),t.$set(t.form,"visitorName",i.data.name.length>50?i.data.name.substr(0,50):i.data.name)):t.$refs.uToast.show({message:"解析失败，请重新上传图片识别！",type:"error"})}})}})},certificateTypeConfirm:function(e){this.form.certificateType=e.name},goodsUpload:function(e,t,i,o){this.maskShow=!1,this.showProgress=!1,200==e.code?(this.goodsList.push(e.msg),this.$refs.uToast.show({message:"上传成功",type:"success"})):this.$refs.uToast.show({message:e.msg,type:"error"})},goodsBeforeRemove:function(e,t){this.goodsList.splice(e,1)},certificateUpload:function(e,t,i,o){this.maskShow=!1,this.showProgress=!1,200==e.code?(this.$refs.uToast.show({message:"上传成功",type:"success"}),this.certificateUrl=e.data.absUrl):(this.deleteItem2(),this.$refs.uToast.show({message:e.msg,type:"error"}))},deleteItem2:function(){this.certificateUrl="",this.$refs.uUpload6.clear()},goodsNumChange:function(e){var t=this.form.goodsNum||"";this.form.goodsNum=t+e},goodsNumBackspace:function(){this.form.goodsNum.length&&(this.form.goodsNum=this.form.goodsNum.substr(0,this.form.goodsNum.length-1))},carChange:function(e){this.visitorCarNumVal.length<9&&(this.visitorCarNumVal+=e,this.form.visitorCarNum=this.visitorCarNumVal)},carBackspace:function(){this.visitorCarNumVal.length&&(this.visitorCarNumVal=this.visitorCarNumVal.substr(0,this.visitorCarNumVal.length-1),this.form.visitorCarNum=this.visitorCarNumVal)},sourceAdrConfirm:function(e){this.$set(this.form,"sourceAddress",e.value.join("-"))},backClick:function(){e.navigateBack({delta:1})},beforeUpload:function(e,t){return this.maskShow=!0,!0},fileUpload:function(e,t,i,o){this.showProgress=!1,this.maskShow=!1,200==e.code?(this.imgBase64=e.data.absUrl||"",this.$refs.uToast.show({message:"上传成功",type:"success"})):(this.$refs.uToast.show({message:e.msg,type:"error"}),this.deleteItem())},uploadError:function(e){console.log(e),this.maskShow=!1},deleteItem:function(){this.imgBase64="",this.$refs.uUpload.clear()},submit:function(){var t=this;this.$refs.uForm.validate().then((function(){if(!t.imgBase64)return t.$refs.uToast.show({message:"请选择来访人员照片",type:"error"});if(t.isShowCertificate&&!t.certificateUrl)return t.$refs.uToast.show({message:"请上传证件照",type:"warning"});var i=c({},t.form);i.visitorCarNum=i.visitorCarNum?i.visitorCarNum:"",i.visitorImgUrl=t.imgBase64,i.certificateUrl=t.certificateUrl,i.visitorGoodImgs=t.goodsList.join(","),i.visitorGoods="",i.goodsName&&(i.visitorGoods+=i.goodsName),i.goodsNum&&(i.visitorGoods+=","+i.goodsNum),i.note&&(i.visitorGoods+=","+i.note),i.show=!1;var o=t.visitHistory.filter((function(e){return e.visitorCertificateCode!=i.visitorCertificateCode}));o.unshift(i),t.visitHistory=(0,r.default)(o),t.visitHistory.length>=10&&t.visitHistory.splice(t.visitHistory.length-1,1),e.setStorage({key:"visitHistory_key",data:t.visitHistory});var n=t.visitForm.findIndex((function(e){return e.visitorCertificateCode===i.visitorCertificateCode}));n>=0?t.visitForm[n]=i:t.visitForm.push(i),t.applyForm.visitForm=t.visitForm,e.setStorage({key:"applyForm_key",data:t.applyForm}),e.redirectTo({url:"../apply/apply"})}))},swipeClick:function(t,i){0==t.index&&(this.visitHistory.splice(i,1),e.setStorage({key:"visitHistory_key",data:this.visitHistory}))},swipeContentClick:function(e){var t=this.visitHistory[e];this.form=t,this.imgBase64=t.visitorImgUrl,this.certificateUrl=t.certificateUrl;var i=t.visitorGoodImgs?t.visitorGoodImgs.split(",").map((function(e){return{url:e}})):[];this.goodsList=i.length?i.map((function(e){return e.url})):[],this.goodsFileList=i,this.showProgress=!1}}};t.default=l}).call(this,i("543d")["default"])},e43b:function(e,t,i){"use strict";var o=i("0269"),r=i.n(o);r.a}},[["4fa8","common/runtime","common/vendor"]]]);