require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pageFk/retinue-formlink/retinue-formlink"],{"490e":function(e,t,o){"use strict";(function(e){var i=o("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(o("9523")),n=i(o("3cda")),s=o("c358"),u=o("d0bf"),a=o("7ff8"),c=i(o("9332"));function m(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function d(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?m(Object(o),!0).forEach((function(t){(0,r.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):m(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var l={components:{wPicker:function(){o.e("components/w-picker/w-picker").then(function(){return resolve(o("c33c"))}.bind(null,o)).catch(o.oe)}},data:function(){var e=this;return{timestamp:null,form:{visitorCarNum:"",goodsNum:"",visitorCertificateCode:"",visitorName:"",visitorSex:1,note:""},imgBase64:"",fileHeader:{appId:"",sid:""},fileAction:"".concat(n.default.baseUrl,"/iot-wx/visitor/upload/pic?token="),showProgress:!0,CodeAction:"".concat(n.default.baseUrl,"/iot-wx/commons/upload"),keyboardCarShow:!1,goodsAction:"".concat(n.default.baseUrl,"/iot-wx/visitor/goods/upload/pic?token="),keyboardNumShow:!1,maskShow:!1,rules:{visitorCompany:[{required:!0,message:"请填写来访单位",trigger:"blur"}],visitorName:[{required:!0,message:"请填写来访人员姓名",trigger:"blur"}],visitorPhone:[{validator:function(t,o,i){return e.$u.test.mobile(o)},message:"手机号码不正确",trigger:"blur"}],certificateType:[{required:!0,message:"请选择证件类型",trigger:["blur","change"]}],visitorCertificateCode:[{required:!0,message:"请输入证件编号",trigger:["blur","change"]}]},visitorNo:"",formInfo:{},sourceType:"appointment",visitorState:"",visitorCertificateCode:"",empInfo:{visitorGoodImgs:[]},isSearch:!1,staticPrefix:"",sourceAdrShow:!1,sourceAdrDic:(0,s.city)(),isShowSourceAddr:!1,isShowCertificate:!1,certificateTypeShow:!1,certificateTypeDic:[{value:"身份证",name:"身份证"},{value:"军官证",name:"军官证"},{value:"驾驶证",name:"驾驶证"},{value:"港澳通行证",name:"港澳通行证"},{value:"台胞证",name:"台胞证"},{value:"护照",name:"护照"},{value:"其他",name:"其他"}],dateType:"date",certificateUrl:"",qrcodeShow:!1,isVisitorQrCode:!0}},onReady:function(){"appointment"===this.sourceType?e.setNavigationBarTitle({title:"随行邀约"}):e.setNavigationBarTitle({title:"访客邀约"})},onLoad:function(e){this.isShowSourceAddr=1==e.S,this.isShowCertificate=1==e.C,this.sourceType=e.T,this.visitorNo=e.N||"",this.dateType=e.dateType||"date",this.fileHeader.appId=e.appId||"",this.fileHeader.sid=e.sid||"",this.form.appId=e.appId,this.form.sid=e.sid,this.initData()},onShareAppMessage:function(e){var t="/pageFk/qrcode-link/qrcode-link?id=".concat(this.empInfo.id,"&num=").concat(this.visitorNo,"&t=").concat(this.dateType,"&sid=").concat(this.form.sid);return{title:"自定义分享标题",path:t}},methods:{copyQrcode:function(){var t="".concat(n.default.linkUrl,"/#/pageFk/qrcode-link/qrcode-link?id=").concat(this.empInfo.id,"&num=").concat(this.visitorNo,"&t=").concat(this.dateType,"&sid=").concat(this.form.sid);(0,c.default)({content:t,success:function(t){e.showToast({title:"复制成功",icon:"success",duration:3e3})},error:function(t){e.showToast({title:"复制失败",icon:"error",duration:3e3})}})},handlerOCR:function(){var t=this;e.chooseImage({success:function(o){t.maskShow=!0,e.uploadFile({url:"".concat(n.default.baseUrl,"/iot-wx/commons/idcard/ocr/recognition"),name:"file",filePath:o.tempFilePaths[0],success:function(e){var o=JSON.parse(e.data);t.maskShow=!1,200==o.code&&o.data.idCardNo?(t.form.visitorCertificateCode=o.data.idCardNo,t.form.visitorName=o.data.name):t.$refs.uToast.show({message:"解析失败，请重新上传识别！",type:"error"})}})}})},initData:function(){var e=this;(0,u.details)({visitorNo:this.visitorNo,visitorCertificateCode:this.visitorCertificateCode}).then((function(t){if(200===t.data.code){var o=t.data.data,i=o.visitorCompany,r=o.visitorArea,n=o.visitorTime,s=o.levalTime,u=o.visitors,a=void 0===u?[]:u,c=o.serverTime,m=o.invitationExpireTime,l=o.targetEmpName,f=o.targetEmpCompany,h=o.visitorState,p=o.staticPrefix,v=o.visitorQrCode,g=o.visitorCardNum;e.visitorState=h,e.staticPrefix=p,s="date"===e.dateType?s.substr(0,10):s.substr(0,16),n="date"===e.dateType?n.substr(0,10):n.substr(0,16);var w=a.length?a[0].visitorName:"";if(e.formInfo={visitorCompany:i,visitorArea:r,visitorTime:n,levalTime:s,empName:w,targetEmpName:l,targetEmpCompany:f},e.timestamp=(new Date(e.iosTransDate(m)).getTime()-new Date(e.iosTransDate(c)).getTime())/1e3,e.timestamp>0&&8==h)e.isShowSourceAddr?e.$nextTick((function(){e.$refs.uForm.setRules(d(d({},e.rules),{},{sourceAddress:[{required:!0,message:"请选择来源地",trigger:["change","blur"]}]}))})):e.$nextTick((function(){return e.$refs.uForm.setRules(e.rules)}));else if(e.visitorCertificateCode){e.isSearch=!0;var b=a.length?a[0]:{};b.visitorGoodImgs=b.visitorGoodImgs?b.visitorGoodImgs.split(","):[],b.visitorCompany=b.visitorCompany?b.visitorCompany:i,b.visitorQrCode=b.visitorQrCode?b.visitorQrCode:v,b.visitorCardNum=b.visitorCardNum?b.visitorCardNum:g,e.empInfo=b}}}))},imgClick:function(t){e.previewImage({urls:[this.staticPrefix+t]})},infoSearch:function(){this.visitorCertificateCode&&(this.isSearch=!0,this.initData())},submit:function(){var t=this;this.$refs.uForm.validate().then((function(){var o=d({},t.form);if(!t.imgBase64)return t.$refs.uToast.show({message:"请上传来访人员照片",type:"warning"});if(t.isShowCertificate&&!t.certificateUrl)return t.$refs.uToast.show({message:"请上传证件照",type:"warning"});o.visitorCarNum=o.visitorCarNum?o.visitorCarNum:"",o.visitorImgUrl=t.imgBase64,o.certificateUrl=t.certificateUrl,o.visitorNo=t.visitorNo;var i=t.$refs.uUpload4.lists.filter((function(e){return 100===e.progress})).map((function(e){return e.response.msg})).join(",");o.visitorGoodImgs=i,o.visitorGoods="",o.goodsName&&(o.visitorGoods+=o.goodsName),o.goodsNum&&(o.visitorGoods+=","+o.goodsNum),o.note&&(o.visitorGoods+=","+o.note);var r=Math.ceil(t.timestamp/60);"appointment"===t.sourceType?(0,u.retinueSubmit)(o).then((function(i){t.$refs.uToast.show({message:i.data.msg,type:"success"}),e.setStorageSync("emp_visitorCertificateCode",o.visitorCertificateCode),e.reLaunch({url:"../success/success?diffTime="+r})})).catch((function(e){t.$refs.uToast.show({message:e,type:"error"})})):(0,a.inviteEmpSubmit)(o).then((function(i){t.$refs.uToast.show({message:i.data.msg,type:"success"}),e.setStorageSync("emp_visitorCertificateCode",o.visitorCertificateCode),e.reLaunch({url:"../success/success?diffTime="+r})})).catch((function(e){t.$refs.uToast.show({message:e,type:"error"})}))}))},certificateTypeConfirm:function(e){this.form.certificateType=e.name},carChange:function(e){this.form.visitorCarNum.length<9&&(this.form.visitorCarNum+=e)},carBackspace:function(){this.form.visitorCarNum.length&&(this.form.visitorCarNum=this.form.visitorCarNum.substr(0,this.form.visitorCarNum.length-1))},sourceAdrConfirm:function(e){this.$set(this.form,"sourceAddress",e.value.join("-"))},goodsNumChange:function(e){this.form.goodsNum+=e},goodsNumBackspace:function(){this.form.goodsNum.length&&(this.form.goodsNum=this.form.goodsNum.substr(0,this.form.goodsNum.length-1))},beforeUpload:function(e,t){return this.maskShow=!0,!0},fileUpload:function(e,t,o,i){this.maskShow=!1,this.showProgress=!1,200==e.code?(this.imgBase64=e.data.absUrl,this.$refs.uToast.show({message:"上传成功",type:"success"})):(this.$refs.uToast.show({message:e.msg,type:"error"}),this.deleteItem())},deleteItem:function(){this.imgBase64="",this.$refs.uUpload.clear()},goodsUpload:function(e,t,o,i){this.maskShow=!1,this.showProgress=!1,200==e.code?this.$refs.uToast.show({message:"上传成功",type:"success"}):this.$refs.uToast.show({message:e.msg,type:"error"})},certificateUpload:function(e,t,o,i){this.maskShow=!1,this.showProgress=!1,200==e.code?(this.$refs.uToast.show({message:"上传成功",type:"success"}),this.certificateUrl=e.data.absUrl):(this.deleteItem2(),this.$refs.uToast.show({message:e.msg,type:"error"}))},deleteItem2:function(){this.certificateUrl="",this.$refs.uUpload6.clear()}}};t.default=l}).call(this,o("543d")["default"])},"4cbd":function(e,t,o){"use strict";(function(e,t){var i=o("4ea4");o("5495");i(o("66fd"));var r=i(o("50c3"));e.__webpack_require_UNI_MP_PLUGIN__=o,t(r.default)}).call(this,o("bc2e")["default"],o("543d")["createPage"])},"50c3":function(e,t,o){"use strict";o.r(t);var i=o("51d4"),r=o("ad00");for(var n in r)["default"].indexOf(n)<0&&function(e){o.d(t,e,(function(){return r[e]}))}(n);o("fc29");var s=o("f0c5"),u=Object(s["a"])(r["default"],i["b"],i["c"],!1,null,"2f770aa2",null,!1,i["a"],void 0);t["default"]=u.exports},"51d4":function(e,t,o){"use strict";o.d(t,"b",(function(){return r})),o.d(t,"c",(function(){return n})),o.d(t,"a",(function(){return i}));var i={myCard:function(){return o.e("components/my-card").then(o.bind(null,"2227"))},uImage:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-image/u-image")]).then(o.bind(null,"a083"))},uCountDown:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-count-down/u-count-down")]).then(o.bind(null,"b595"))},uForm:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-form/u-form")]).then(o.bind(null,"ff33"))},uIcon:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(o.bind(null,"1e79"))},myUpload:function(){return Promise.all([o.e("common/vendor"),o.e("components/my-upload")]).then(o.bind(null,"efc5"))},uFormItem:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(o.bind(null,"f4f7"))},uInput:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-input/u-input")]).then(o.bind(null,"f18a"))},uRadioGroup:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-radio-group/u-radio-group")]).then(o.bind(null,"9f38"))},uRadio:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-radio/u-radio")]).then(o.bind(null,"082a"))},"u-Textarea":function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u--textarea/u--textarea")]).then(o.bind(null,"433b"))},uGap:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-gap/u-gap")]).then(o.bind(null,"c921"))},myButton:function(){return o.e("components/my-button").then(o.bind(null,"e84c"))},uSearch:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-search/u-search")]).then(o.bind(null,"424e"))},uAvatar:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-avatar/u-avatar")]).then(o.bind(null,"b1e7"))},tkiQrcode:function(){return Promise.all([o.e("common/vendor"),o.e("components/tki-qrcode/tki-qrcode")]).then(o.bind(null,"d0fb"))},uCellGroup:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-cell-group/u-cell-group")]).then(o.bind(null,"f7ef"))},uCell:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-cell/u-cell")]).then(o.bind(null,"0137"))},uPopup:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(o.bind(null,"3d93"))},uActionSheet:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-action-sheet/u-action-sheet")]).then(o.bind(null,"ff2a"))},wPicker:function(){return o.e("components/w-picker/w-picker").then(o.bind(null,"c33c"))},uKeyboard:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-keyboard/u-keyboard")]).then(o.bind(null,"1a2a"))},uOverlay:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-overlay/u-overlay")]).then(o.bind(null,"3776"))},uToast:function(){return o.e("uni_modules/uview-ui/components/u-toast/u-toast").then(o.bind(null,"b688"))}},r=function(){var e=this,t=e.$createElement,o=(e._self._c,e.timestamp>0&&8==e.visitorState?e.imgBase64.length:null),i=e.timestamp>0&&8==e.visitorState?e.isShowCertificate&&e.certificateUrl.length>0:null,r=e.timestamp>0&&8==e.visitorState?e.isShowCertificate&&0===e.certificateUrl.length:null;e._isMounted||(e.e0=function(t){e.maskShow=!1},e.e1=function(t){e.certificateTypeShow=!0},e.e2=function(t){e.maskShow=!1},e.e3=function(t){e.sourceAdrShow=!0},e.e4=function(t){e.keyboardCarShow=!0},e.e5=function(t){e.keyboardNumShow=!0},e.e6=function(t){e.maskShow=!1},e.e7=function(t){e.qrcodeShow=!0},e.e8=function(t){e.qrcodeShow=!1},e.e9=function(t){e.isVisitorQrCode=!e.isVisitorQrCode},e.e10=function(t){e.certificateTypeShow=!1},e.e11=function(t){e.keyboardCarShow=!1},e.e12=function(t){e.keyboardCarShow=!1},e.e13=function(t){e.keyboardNumShow=!1},e.e14=function(t){e.keyboardNumShow=!1}),e.$mp.data=Object.assign({},{$root:{g0:o,g1:i,g2:r}})},n=[]},9517:function(e,t,o){},ad00:function(e,t,o){"use strict";o.r(t);var i=o("490e"),r=o.n(i);for(var n in i)["default"].indexOf(n)<0&&function(e){o.d(t,e,(function(){return i[e]}))}(n);t["default"]=r.a},fc29:function(e,t,o){"use strict";var i=o("9517"),r=o.n(i);r.a}},[["4cbd","common/runtime","common/vendor","pageFk/common/vendor"]]]);