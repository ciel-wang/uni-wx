require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pageFk/apply/apply"],{"04d5":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i("ac48"),n=i("25d6"),s=i("7ff8"),r={components:{wPicker:function(){i.e("components/w-picker/w-picker").then(function(){return resolve(i("c33c"))}.bind(null,i)).catch(i.oe)}},data:function(){var t=this;return{form:{visitorCompany:"",visitorTime:"",levalTime:"",visitArea:"",visitorCause:"",visitorPersonCount:"",invitationMinuteExpire:""},lefticonstyle:{"font-size":"34rpx"},visitList:[],visitDateShow:!1,visitMindate:e.$u.timeFormat(new Date),departureDateShow:!1,departureMinDate:"",departureMaxDate:"",defaultLeaveTime:"23:59:59",betweenTime:4,visitAreaList:[],visitAreaShow:!1,visitReasonsList:[],visitorMaxEmpNum:99,keyboardNumShow:!1,invitationMinuteExpireShow:!1,invitationMinuteExpireList:[{value:0,name:"离访时间"},{value:10,name:"10分钟"},{value:20,name:"20分钟"},{value:30,name:"30分钟"},{value:40,name:"40分钟"},{value:50,name:"50分钟"},{value:60,name:"60分钟"}],actionSheetShow:!1,actionSheetData:[],actionSheetTitle:"",agreement:!1,popupshow:!1,strings:"",btnDisabled:!1,maskShow:!1,maxDays:"",dateType:"date",applyForms:{},type:"select",rules:{interviewees:[{required:!0,message:"请添加被访人员信息",trigger:["change","blur"]}],visitors:[{validator:function(e,i,o){return t.$u.test.array(i)&&i.length>0},message:"请添加来访人员信息",trigger:["change","blur"]}],visitorCompany:[{required:!0,message:"请填写来访单位",trigger:["change","blur"]}],visitorTime:[{required:!0,message:"请选择到访时间",trigger:["change","blur"]}],levalTime:[{required:!0,message:"请选择离访时间",trigger:["change","blur"]}],visitArea:[{required:!0,message:"请选择到访区域",trigger:["change","blur"]}],visitorCause:[{required:!0,message:"请选择到访事由",trigger:"blur"}],visitorPersonCount:[{required:!0,message:"请输入人数",trigger:["change","blur"]}],invitationMinuteExpire:[{required:!0,message:"请选择邀请有效时长"}]},visitorTimeLabel:"",levalTimeLabel:""}},onLoad:function(t){try{var i=e.getStorageSync("applyForm_key");if(i){if(i.targetVisitorEmpName){var o=i.targetVisitorEmpName.length>8?i.targetVisitorEmpName.substr(0,8)+"...":i.targetVisitorEmpName;this.form.interviewees=o+" "+i.targetVisitorEmpPhone}this.form["targetVisitorEmpPhone"]=i.targetVisitorEmpPhone,this.form["targetVisitorEmpName"]=i.targetVisitorEmpName,i.visitForm&&(this.visitList=i.visitForm),this.form.visitors=this.visitList,this.form.visitorCompany=i.visitorCompany,this.form.visitorTime=i.visitorTime,this.form.levalTime=i.levalTime,this.form.visitArea=i.visitArea,this.form["visitorAreaId"]=i.visitorAreaId,this.form.visitorCause=i.visitorCause,this.form.visitorPersonCount=i.visitorPersonCount,this.form.invitationMinuteExpireLabel=i.invitationMinuteExpireLabel,this.form.invitationMinuteExpire=i.invitationMinuteExpire,this.applyForms=i}}catch(n){console.log(n)}this.initPageData()},onReady:function(){this.$refs.uForm.setRules(this.rules),2==this.vuex_useInfo.bindEmpType?e.setNavigationBarTitle({title:"教职工邀约"}):e.setNavigationBarTitle({title:"访客预约"})},methods:{btnClick:function(t){var i=this;this.$refs.uForm.validate().then((function(){if(!i.agreement)return i.$u.toast("请勾选协议");var o=e.$u.deepClone(i.form);if("datetime"===i.dateType){o.visitorTime=o.visitorTime+":00",o.levalTime=o.levalTime+":59";var n=new Date(i.iosTransDate(o.visitorTime)).getTime(),r=new Date(i.iosTransDate(o.levalTime)).getTime(),a=r-n;if(a>864e5*i.maxDays)return i.$refs.uToast.show({message:"最大只可预约".concat(i.maxDays,"天"),type:"error",icon:!1})}2!=i.vuex_useInfo.bindEmpType?"left"===t?i.$u.route("/pageFk/retinue-ask/retinue-ask",{dateType:i.dateType,visitorMaxEmpNum:i.visitorMaxEmpNum}):(i.maskShow=!0,(0,s.submit)(o).then((function(t){i.maskShow=!1,i.btnDisabled=!0,e.removeStorageSync("applyForm_key"),e.removeStorageSync("goodsHistory_key"),i.$refs.uToast.show({message:t.data.msg,type:"success"}),setTimeout((function(){i.backClick()}),2e3)})).catch((function(e){i.maskShow=!1,i.$refs.uToast.show({message:e,type:"error",icon:!1})}))):(i.maskShow=!0,(0,s.targetInviteSubmit)(o).then((function(t){i.maskShow=!1,i.btnDisabled=!0,e.removeStorageSync("applyForm_key"),i.$refs.uToast.show({message:t.data.msg,type:"success"}),setTimeout((function(){i.$u.route("/pageFk/retinue-details/retinue-details",{visitorNo:t.data.data.visitorNo})}),3e3)})).catch((function(e){i.maskShow=!1,i.$refs.uToast.show({message:e,type:"error",icon:!1})})))}))},initPageData:function(){var e=this;this.visitAreaList=[],this.visitReasonsList=[],(0,n.initFkCfg)().then((function(t){if(200==t.data.code){var i=t.data.data;e.strings=i.FK_RULE_DESCRIPTION,e.maxDays=i.FK_APPOINTMENT_MAX_DYAS||1,e.dateType=i.FK_YUYUE_DATE_OR_DATETIME_OPTIONS||"date",e.visitorMaxEmpNum=i.VISITOR_FOLLOW_UP_MAX_PERSON_COUNT||6,e.defaultLeaveTime=i.VISITOR_ZW_YY_TIME||"23:59:59",e.betweenTime=i.VISITOR_DEFAULT_YY_DURATION||2,e.visitAreaList=(0,o.deleteEmptyArr)(i.areaSelectData,2);var n=i.causes[0].val;n=n.split("#");var s=n.map((function(e,t){return{value:t,name:e}}));e.visitReasonsList=s}}))},intervieweesClick:function(){this.$u.route("/pageFk/interviewees/interviewees")},visitClick:function(){this.$u.route("/pageFk/visitor/visitor")},deleteClick:function(t){this.visitList.splice(t,1),this.form.visitors=this.visitList,this.applyForms.visitForm=this.visitList,e.removeStorageSync("applyForm_key"),e.setStorageSync("applyForm_key",this.applyForms)},visitorCompanyBlur:function(t){this.form.visitorCompany=t,this.applyForms.visitorCompany=t,e.setStorageSync("applyForm_key",this.applyForms)},visitDateConfirm:function(t){if("datetime"===this.dateType){var i=e.$u.timeFormat(t.value,"yyyy-mm-dd hh:MM");this.form.visitorTime=i,this.applyForms.visitorTime=i;var o=t.value+60*this.betweenTime*60*1e3,n=e.$u.timeFormat(t.value,"yyyy-mm-dd ")+this.defaultLeaveTime;if(1*new Date(this.iosTransDate(n))-t.value<=0)return this.visitDateShow=!1,this.$refs.uToast.show({message:"当前预约时间过晚，当天最晚离访时间为".concat(this.defaultLeaveTime),type:"warning",icon:!1}),!1;1*new Date(this.iosTransDate(n))-o<=0?(this.form.levalTime=n.substr(0,16),this.applyForms.levalTime=n.substr(0,16)):(this.form.levalTime=e.$u.timeFormat(o,"yyyy-mm-dd hh:MM"),this.applyForms.levalTime=e.$u.timeFormat(o,"yyyy-mm-dd hh:MM")),this.visitDateShow=!1}if("date"===this.dateType){var s=e.$u.timeFormat(t.value,"yyyy-mm-dd");this.form.visitorTime=s,this.applyForms.visitorTime=s,this.form.levalTime=s,this.applyForms.levalTime=s,this.visitDateShow=!1}e.setStorageSync("applyForm_key",this.applyForms),this.$forceUpdate()},levalTimeClick:function(){var t=this.form.visitorTime;if(!t)return this.$refs.uToast.show({message:"请先选择到访时间！",type:"warning",icon:!1});var i=new Date(this.iosTransDate(t)).getTime();this.departureMinDate=i;this.defaultLeaveTime&&this.defaultLeaveTime;var o=e.$u.timeFormat(i,"yyyy-mm-dd ")+this.defaultLeaveTime;if(1==this.maxDays){if("datetime"===this.dateType)return this.departureMaxDate=new Date(this.iosTransDate(o)).getTime(),this.departureDateShow=!0,!1;this.departureDateShow=!1}else if(0==this.maxDays)this.departureMaxDate=new Date("2050/05/31").getTime(),this.departureDateShow=!0;else{var n=1*new Date(this.iosTransDate(o))+24*(this.maxDays-1)*60*60*1e3;this.departureMaxDate=n,this.departureDateShow=!0}},departureDateConfirm:function(t){if("datetime"===this.dateType){var i=e.$u.timeFormat(t.value,"yyyy-mm-dd ")+this.defaultLeaveTime;if(this.form.visitorTime&&t.value-1*new Date(this.iosTransDate(this.form.visitorTime))<=0)return this.departureDateShow=!1,this.$refs.uToast.show({message:"离访时间不能小于到访时间",type:"warning",icon:!1});if(1*new Date(this.iosTransDate(i))-t<=0)return this.departureDateShow=!1,this.$refs.uToast.show({message:"当前离访时间过晚，当天最晚离访时间为".concat(this.defaultLeaveTime),type:"warning",icon:!1}),!1}var o=e.$u.timeFormat(t.value,"datetime"===this.dateType?"yyyy-mm-dd hh:MM":"yyyy-mm-dd");this.form.levalTime=o,this.applyForms.levalTime=o,e.setStorageSync("applyForm_key",this.applyForms),this.departureDateShow=!1},visitAreaConfirm:function(t){this.form.visitArea="",this.applyForms.visitArea="",this.form.visitArea=t.result,this.applyForms.visitArea=t.result,this.form["visitorAreaId"]=t.value[2],this.applyForms["visitorAreaId"]=t.value[2],this.$forceUpdate(),e.setStorageSync("applyForm_key",this.applyForms)},handlerSelect:function(e){"visitorCause"===e&&(this.actionSheetTitle="请选择到访事由",this.actionSheetData=this.visitReasonsList),"invitationMinuteExpire"===e&&(this.actionSheetTitle="请选择邀请有效时长",this.actionSheetData=this.invitationMinuteExpireList),this.selectType=e,this.actionSheetShow=!0},actionSheetChange:function(t){"visitorCause"===this.selectType&&(this.form["visitorCause"]=t.name,this.applyForms.visitorCause=t.name,e.setStorageSync("applyForm_key",this.applyForms)),"invitationMinuteExpire"===this.selectType&&(this.form.invitationMinuteExpireLabel=t.name,this.form.invitationMinuteExpire=t.value,this.$set(this.form,"invitationMinuteExpire",t.value),this.applyForms.invitationMinuteExpireLabel=t.name,this.applyForms.invitationMinuteExpire=t.value,e.setStorageSync("applyForm_key",this.applyForms))},visitorPersonCountChange:function(t){var i=this.form.visitorPersonCount?this.form.visitorPersonCount+t:t;1*i<=this.visitorMaxEmpNum&&(this.$set(this.form,"visitorPersonCount",i+""),this.applyForms.visitorPersonCount=i+"",e.setStorageSync("applyForm_key",this.applyForms))},visitorPersonCountBackspace:function(){this.form.visitorPersonCount.length&&(this.form.visitorPersonCount=this.form.visitorPersonCount.substr(0,this.form.visitorPersonCount.length-1),this.applyForms.visitorPersonCount=this.form.visitorPersonCount,e.setStorageSync("applyForm_key",this.applyForms))},checkboxChange:function(e){this.agreement=!!e.length},phoneClick:function(t){e.makePhoneCall({phoneNumber:t})},backClick:function(){e.switchTab({url:"/pages/index/index"})}}};t.default=r}).call(this,i("543d")["default"])},"0ff3":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return o}));var o={uIcon:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(i.bind(null,"1e79"))},uForm:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-form/u-form")]).then(i.bind(null,"ff33"))},myCard:function(){return i.e("components/my-card").then(i.bind(null,"2227"))},uFormItem:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(i.bind(null,"f4f7"))},uInput:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-input/u-input")]).then(i.bind(null,"f18a"))},uCheckboxGroup:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-checkbox-group/u-checkbox-group")]).then(i.bind(null,"97f5"))},uCheckbox:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-checkbox/u-checkbox")]).then(i.bind(null,"f04a"))},myButton:function(){return i.e("components/my-button").then(i.bind(null,"e84c"))},uPopup:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(i.bind(null,"3d93"))},uParse:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-parse/u-parse")]).then(i.bind(null,"edb0"))},uActionSheet:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-action-sheet/u-action-sheet")]).then(i.bind(null,"ff2a"))},uKeyboard:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-keyboard/u-keyboard")]).then(i.bind(null,"1a2a"))},uDatetimePicker:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-datetime-picker/u-datetime-picker")]).then(i.bind(null,"2990"))},wPicker:function(){return i.e("components/w-picker/w-picker").then(i.bind(null,"c33c"))},uOverlay:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-overlay/u-overlay")]).then(i.bind(null,"3776"))},uToast:function(){return i.e("uni_modules/uview-ui/components/u-toast/u-toast").then(i.bind(null,"b688"))}},n=function(){var e=this,t=e.$createElement,i=(e._self._c,2!=e.vuex_useInfo.bindEmpType?e.visitList.length:null),o=2!=e.vuex_useInfo.bindEmpType&&i>0?e.__map(e.visitList,(function(t,i){var o=e.__get_orig(t),n=t.visitorName.length,s=n>8?t.visitorName.substr(0,8):null;return{$orig:o,g1:n,g2:s}})):null,n=new Date("2050/05/31").getTime(),s=(new Date).getTime();e._isMounted||(e.e0=function(t){e.visitDateShow=!0},e.e1=function(t){e.visitAreaShow=!0},e.e2=function(t){e.keyboardNumShow=!0},e.e3=function(t){e.popupshow=!0},e.e4=function(t){e.popupshow=!1},e.e5=function(t){e.actionSheetShow=!1},e.e6=function(t){e.keyboardNumShow=!1},e.e7=function(t){e.keyboardNumShow=!1},e.e8=function(t){e.visitDateShow=!1},e.e9=function(t){e.visitDateShow=!1},e.e10=function(t){e.departureDateShow=!1},e.e11=function(t){e.departureDateShow=!1}),e.$mp.data=Object.assign({},{$root:{g0:i,l0:o,g3:n,g4:s}})},s=[]},3357:function(e,t,i){"use strict";var o=i("5d37"),n=i.n(o);n.a},"5d37":function(e,t,i){},"9bc3":function(e,t,i){"use strict";i.r(t);var o=i("0ff3"),n=i("ec1d");for(var s in n)["default"].indexOf(s)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(s);i("3357");var r=i("f0c5"),a=Object(r["a"])(n["default"],o["b"],o["c"],!1,null,"f5ee7b56",null,!1,o["a"],void 0);t["default"]=a.exports},d110:function(e,t,i){"use strict";(function(e,t){var o=i("4ea4");i("5495");o(i("66fd"));var n=o(i("9bc3"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(n.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},ec1d:function(e,t,i){"use strict";i.r(t);var o=i("04d5"),n=i.n(o);for(var s in o)["default"].indexOf(s)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(s);t["default"]=n.a}},[["d110","common/runtime","common/vendor","pageFk/common/vendor"]]]);