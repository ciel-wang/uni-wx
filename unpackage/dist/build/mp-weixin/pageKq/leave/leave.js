require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pageKq/leave/leave"],{"5d1b":function(e,t,i){"use strict";var r=i("da9b"),o=i.n(r);o.a},"944b":function(e,t,i){"use strict";(function(e){var r=i("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(i("9523")),s=r(i("3cda")),n=i("25b0"),m=(i("ac48"),i("c358"));function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function c(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){(0,o.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var u={components:{wPicker:function(){i.e("components/w-picker/w-picker").then(function(){return resolve(i("c33c"))}.bind(null,i)).catch(i.oe)}},data:function(){var e=this;return{receiptType:"",form:{empName:"",typeRoleName:"",startTime:"",endTime:"",receiptCause:"",receiptVehicle:"1",isOneWay:!0,bkTimeSteps:[],isLeave:0,duration:"",endTimeMax:0},receiptsForm:{empName:"",typeRoleName:"",startTime:"",endTime:"",receiptCause:"",receiptVehicle:"1",isOneWay:!0,bkTimeSteps:[],isLeave:0,duration:"",endTimeMax:0},rules:{empName:[{required:!0,message:"请选择",trigger:["change","blur"]}],typeRoleName:[{required:!0,message:"请选择",trigger:["change","blur"]}],bkTimeSteps:[{validator:function(t,i,r){return e.$u.test.array(i)&&i.length>0},message:"请选择",trigger:["change","blur"]}],receiptCause:[{required:!0,message:"请填写",trigger:["blur"]}]},maskShow:!1,maskValue:"",typeRoleShow:!1,typeRoleList:[],startTimeShow:!1,startTimeValue:Number(new Date),endTimeShow:!1,endTimeValue:Number(new Date),imgAction:"".concat(s.default.baseUrl,"/iot-wx/kq/receipt/upload/imgs"),imgList:[],duplicateEmpList:[],receiptVehicleList:[{label:"飞机",value:"1"},{label:"火车",value:"2"},{label:"汽车",value:"3"},{label:"其他",value:"4"}],isOneWayList:[{value:1,label:"单程"},{value:0,label:"往返"}],isOneWayType:"1",vehicleType:"1",fileList:[],jbTimeTabel:[],sourceType:"",bkTimeSteps:[],cardCountMax:1,radioArr:[{value:1,label:"是"},{value:0,label:"否"}],empType:"",showProgress:!1,cityShow:!1,cityList:(0,m.city)(),btnType:"",receiptTypeArr:["请假","出差","加班","补卡"],curEmpInfo:{}}},onLoad:function(t){var i=this;"mykq"==t.come&&(this.mykq="mykq"),this.sourceType=t.sourceType,this.fileList=[],this.receiptType=t.type;var r=e.getStorageSync("receiptsForm_key");r&&t.type!=r.receiptType&&(r=null,e.removeStorageSync("receiptsForm_key")),this.bkTimeSteps=r&&r.bkTimeSteps||[],this.jbTimeTabel=r&&r.jbTimeSteps||[],this.duplicateEmpList=r&&r.duplicateEmpList||[];var o=r&&r.receiptImgs&&r.receiptImgs.split(",")||[];this.imgList=o,this.fileList=o.map((function(e){return{url:e}})),this.isOneWayType=r&&r.isOneWay?1:0,this.vehicleType=r&&r.receiptVehicle?r.receiptVehicle:1;var s=this.vuex_useInfo,m=s.empName,a=void 0===m?"":m,c=s.empId,u=void 0===c?"":c,p=s.deptName,l=void 0===p?"":p;if(this.curEmpInfo={empName:a,empId:u,deptName:l},r){if(this.form=e.$u.deepClone(r),this.receiptsForm=e.$u.deepClone(r),Array.isArray(r.receiptTogether)&&r.receiptTogether.length){var h=[],d=[];r.receiptTogether.forEach((function(e){h.push(e.id),d.push(e.empName)})),d.length>3?this.form.togetherEmps=d.slice(0,3).join(",")+"等".concat(d.length,"人"):this.form.togetherEmps=d.join(","),this.form["receiptTogethers"]=h.join(",")}!r.typeRoleId||r.limitMaxTime&&r.limitMinTime&&r.cardCountMax||(0,n.limitTime)({typeRoleId:r.typeRoleId,type:2}).then((function(e){if(200==e.data.code){var t=e.data.data;i.cardCountMax=t.limitMaxCount,4==i.receiptType&&0==i.cardCountMax&&(i.$refs.uToast.show({message:"本月补卡次数已超额，不能再进行补卡",type:"error"}),i.bkTimeSteps=[]),Array.isArray(t.limitDays)&&t.limitDays.length>0&&(i.form.limitMaxTime=t.limitDays[0].LEAVETIME_MAX_MINUTE,i.form.limitMinTime=t.limitDays[1].LEAVETIME_MIN_MINUTE)}}))}(!r||r&&!r.empId)&&(this.form["empName"]=a,this.form["empId"]=u,this.form["deptName"]=l,this.receiptsForm["empName"]=a,this.receiptsForm["empId"]=u,this.receiptsForm["deptName"]=l,this.receiptsForm["receiptType"]=t.type,e.setStorageSync("receiptsForm_key",this.receiptsForm)),(0,n.receiptTyperolelist)({roleType:this.receiptType}).then((function(e){if(200==e.data.code){var t=e.data.data,r=[];1==i.receiptType&&(r=t.qj.map((function(e){return{value:e.id,name:e.roleName}}))),2==i.receiptType&&(r=t.cc.map((function(e){return{value:e.id,name:e.roleName}}))),3==i.receiptType&&(r=t.jb.map((function(e){return{value:e.id,name:e.roleName}}))),4==i.receiptType&&(r=t.bk.map((function(e){return{value:e.id,name:e.roleName}}))),i.typeRoleList=r}}))},onReady:function(){1==this.receiptType?e.setNavigationBarTitle({title:"请假"}):2==this.receiptType?e.setNavigationBarTitle({title:"出差"}):3==this.receiptType?e.setNavigationBarTitle({title:"加班"}):e.setNavigationBarTitle({title:"补卡"}),4!=this.receiptType&&(this.rules=c(c({},this.rules),{},{startTime:[{required:!0,message:"请选择",trigger:["change","blur"]}],endTime:[{required:!0,message:"请选择",trigger:["change","blur"]}]})),this.$refs.uForm.setRules(this.rules)},watch:{"form.isLeave":{handler:function(e){var t={};t["leaveCause"]=1==e?[{required:!0,message:"请填写外出去向",trigger:["change","blur"]}]:[],this.rules=c(c({},this.rules),t),this.$refs.uForm.setRules(this.rules)},deep:!0}},methods:{submit:function(){var t=this;this.$refs.uForm.validate().then((function(){if(t.form.auditEmpIds){t.form["receiptType"]=t.receiptType,t.form["receiptTogether"]=t.form["receiptTogethers"];var i=t.form,r=i.limitMaxTime,o=i.limitMinTime;if(1==t.receiptType&&(1*i.workTime>r||1*i.workTime<o))t.$refs.uToast.show({message:"请假时长不在".concat(o,"-").concat(r,"范围内"),type:"error"});else{var s=e.$u.deepClone(t.form);if(1==t.receiptType||2==t.receiptType){var m=s.startTime+":00";s.startTime=m,s.endTime&&(s.endTime=s.endTime+":59")}if(4==t.receiptType){var a=s.bkTimeSteps||[];s.bkTimeSteps=a.map((function(e){return e+":00"}))}t.maskShow=!0,t.maskValue="正在提交，请等待...","edit"==t.sourceType?(0,n.updateForm)(s).then((function(i){t.maskShow=!1,t.$refs.uToast.show({message:i.data.msg,type:"success"}),setTimeout((function(){t.backClick()}),2e3),e.removeStorageSync("receiptsForm_key")})).catch((function(e){t.maskShow=!1,t.$refs.uToast.show({message:e,type:"error"})})):(0,n.sendForm)(s).then((function(i){t.maskShow=!1,t.$refs.uToast.show({message:i.data.msg,type:"success"}),setTimeout((function(){t.backClick()}),2e3),e.removeStorageSync("receiptsForm_key")})).catch((function(e){t.maskShow=!1,t.$refs.uToast.show({message:e,type:"error"})}))}}else t.$refs.uToast.show({message:"请先选择审批人",type:"error"})}))},typeRoleConfirm:function(t){var i=this;this.form["typeRoleName"]=t.name,this.form["typeRoleId"]=t.value,this.form.auditEmpIds="",this.receiptsForm["auditEmpIds"]="",this.receiptsForm["typeRoleName"]=t.name,this.receiptsForm["typeRoleId"]=t.value,(0,n.limitTime)({typeRoleId:t.value,type:2}).then((function(t){if(200==t.data.code){var r=t.data.data;i.cardCountMax=r.limitMaxCount,4==i.receiptType&&0==i.cardCountMax&&(i.$refs.uToast.show({message:"本月补卡次数已超额，不能再进行补卡",type:"error"}),i.bkTimeSteps=[],i.form.bkTimeSteps=[],i.receiptsForm.bkTimeSteps=[]),Array.isArray(r.limitDays)&&r.limitDays.length>0&&(i.receiptsForm.limitMaxTime=r.limitDays[0].LEAVETIME_MAX_MINUTE,i.receiptsForm.limitMinTime=r.limitDays[1].LEAVETIME_MIN_MINUTE),e.setStorageSync("receiptsForm_key",i.receiptsForm)}}))},startTimeChange:function(t){if(4==this.receiptType){var i=e.$u.timeFormat(t.value,"yyyy-mm-dd hh:MM");return this.bkTimeSteps.push(i),this.form.bkTimeSteps=this.bkTimeSteps,this.receiptsForm.bkTimeSteps=this.bkTimeSteps,e.setStorageSync("receiptsForm_key",this.receiptsForm),void(this.startTimeShow=!1)}if(this.form.endTimeMin=t.value,this.receiptsForm.endTimeMin=t.value,3==this.receiptType){var r=e.$u.timeFormat(t.value,"yyyy-mm-dd");this.form["startTime"]=r,this.receiptsForm["startTime"]=r,this.form["endTime"]="",this.receiptsForm["endTime"]="",this.jbTimeTabel=[],this.form["jbTimeSteps"]=[],this.receiptsForm["jbTimeSteps"]=[],this.form.endTimeMax=t.value+6048e5,this.receiptsForm.endTimeMax=t.value+6048e5}else{var o=e.$u.timeFormat(t.value,"yyyy-mm-dd hh:MM");this.form["startTime"]=o,this.receiptsForm["startTime"]=o,this.form["endTime"]="",this.receiptsForm["endTime"]="",this.form.workTime="",this.form.duration="",this.receiptsForm.workTime="",this.receiptsForm.duration=""}e.setStorageSync("receiptsForm_key",this.receiptsForm),this.startTimeShow=!1},endTimeClick:function(){this.form.startTime?this.endTimeShow=!0:this.$refs.uToast.show({message:"请先选择开始时间",type:"error"})},endTimeChange:function(t){var i=this;if(3==this.receiptType){var r=e.$u.timeFormat(t.value,"yyyy-mm-dd");if(this.form["endTime"]=r,this.receiptsForm["endTime"]=r,this.form["startTime"]){for(var o=this.form["startTime"],s=this.form["endTime"],m=new Date(this.iosTransDate(o)).getTime(),a=new Date(this.iosTransDate(s)).getTime(),c=a-m,u=[],p=0;p<=c;p+=864e5){var l=new Date(m+p);u.push({dayDate:e.$u.timeFormat(l,"yyyy-mm-dd"),minute:0})}this.jbTimeTabel=u,this.form["jbTimeSteps"]=u,this.receiptsForm["jbTimeSteps"]=u}e.setStorageSync("receiptsForm_key",this.receiptsForm),this.endTimeShow=!1}else{var h=e.$u.timeFormat(t.value,"yyyy-mm-dd hh:MM");this.form["endTime"]=h,this.receiptsForm["endTime"]=h,e.setStorageSync("receiptsForm_key",this.receiptsForm),this.endTimeShow=!1;var d={};d["empId"]=this.form.empId,d["startTime"]=this.form.startTime+":00",d["endTime"]=this.form.endTime+":59",(0,n.getDuration)(d).then((function(t){if(200==t.data.code){var r=t.data.data;i.form.duration=(r.totalMinute/60).toFixed(1),i.$set(i.form,"duration",(r.totalMinute/60).toFixed(1)),i.form.workTime=(r.totalMinute/60).toFixed(1),i.receiptsForm.workTime=(r.totalMinute/60).toFixed(1),i.receiptsForm.duration=(r.totalMinute/60).toFixed(1),e.setStorageSync("receiptsForm_key",i.receiptsForm)}})).catch((function(e){i.$refs.uToast.show({message:e,type:"error"})}))}},hourBlur:function(t){this.form.jbTimeSteps=this.jbTimeTabel,this.receiptsForm.jbTimeSteps=this.jbTimeTabel;var i=this.jbTimeTabel,r=0;i.forEach((function(e){e.minute=!e.minute||e.minute>24?0:Math.round(e.minute*Math.pow(10,1))/Math.pow(10,1),e.minute&&(r+=1*e.minute)})),this.$set(this.form,"duration",r),this.receiptsForm.duration=r,e.setStorageSync("receiptsForm_key",this.receiptsForm)},beforeUpload:function(e,t){return this.maskValue="正在上传，请等待...",this.maskShow=!0,this.showProgress=!0,!0},fileError:function(e,t,i,r){this.maskShow=!1,this.showProgress=!1},fileUpload:function(t,i,r,o){this.maskShow=!1,this.showProgress=!1,200==t.code?(this.imgList.push(t.data.absUrl),this.receiptsForm.receiptImgs=this.imgList.join(","),e.setStorageSync("receiptsForm_key",this.receiptsForm),this.$refs.uToast.show({message:"上传成功",type:"success"})):this.$refs.uToast.show({message:t.msg,type:"error"})},beforeRemove:function(t,i){this.fileList=[],this.imgList.splice(t,1),this.receiptsForm.receiptImgs=this.imgList.join(","),e.setStorageSync("receiptsForm_key",this.receiptsForm)},isOneWayChange:function(t){1==t?(this.form["isOneWay"]=!0,this.receiptsForm["isOneWay"]=!0,this.isOneWayType=t):(this.form["isOneWay"]=!1,this.receiptsForm["isOneWay"]=!1,this.isOneWayType=t),e.setStorageSync("receiptsForm_key",this.receiptsForm)},vehicleChange:function(t){this.form["receiptVehicle"]=t,this.receiptsForm["receiptVehicle"]=t,this.vehicleType=t,e.setStorageSync("receiptsForm_key",this.receiptsForm)},getEmp:function(t){var i=this.form;"auditEmpIds"!=t.come||i.empId&&i.typeRoleId?e.redirectTo({url:"../selectedEmp/selectedEmp?come=".concat(t.come,"&type=").concat(this.receiptType,"&mykq=").concat(this.mykq,"&sourceType=").concat(this.sourceType)}):this.$u.toast("请先选择提交人和单据类型")},fromCityBlur:function(t){this.receiptsForm["fromCity"]=t,e.setStorageSync("receiptsForm_key",this.receiptsForm)},toCityBlur:function(t){this.receiptsForm["toCity"]=t,e.setStorageSync("receiptsForm_key",this.receiptsForm)},receiptCauseBlur:function(t){this.receiptsForm["receiptCause"]=this.form.receiptCause,e.setStorageSync("receiptsForm_key",this.receiptsForm)},isLeaveChange:function(t){this.receiptsForm["isLeave"]=t,e.setStorageSync("receiptsForm_key",this.receiptsForm)},leaveCauseBlur:function(t){this.receiptsForm["leaveCause"]=t,e.setStorageSync("receiptsForm_key",this.receiptsForm)},delClick:function(t){this.duplicateEmpList.splice(t,1);var i=[];this.duplicateEmpList.forEach((function(e){i.push(e.id)})),this.receiptsForm.duplicateEmpIds=i.join(","),e.setStorageSync("receiptsForm_key",this.receiptsForm)},cityConfirm:function(t){var i=t.value;"from"===this.btnType?(this.$set(this.form,"fromCity",i.join("-")),this.$set(this.receiptsForm,"fromCity",i.join("-"))):(this.$set(this.form,"toCity",i.join("-")),this.$set(this.receiptsForm,"toCity",i.join("-"))),e.setStorageSync("receiptsForm_key",this.receiptsForm)},deleteClick:function(t){this.bkTimeSteps.splice(t,1),this.form.bkTimeSteps=this.bkTimeSteps,this.receiptsForm.bkTimeSteps=this.bkTimeSteps,e.setStorageSync("receiptsForm_key",this.receiptsForm)},backClick:function(){this.mykq?e.redirectTo({url:"../../mykq/mykq"}):e.switchTab({url:"/pages/index/index"})}}};t.default=u}).call(this,i("543d")["default"])},ac98:function(e,t,i){"use strict";i.r(t);var r=i("d9f6"),o=i("c85e");for(var s in o)["default"].indexOf(s)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(s);i("5d1b");var n=i("f0c5"),m=Object(n["a"])(o["default"],r["b"],r["c"],!1,null,"1bfbc58c",null,!1,r["a"],void 0);t["default"]=m.exports},b9bb:function(e,t,i){"use strict";(function(e,t){var r=i("4ea4");i("5495");r(i("66fd"));var o=r(i("ac98"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(o.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},c85e:function(e,t,i){"use strict";i.r(t);var r=i("944b"),o=i.n(r);for(var s in r)["default"].indexOf(s)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(s);t["default"]=o.a},d9f6:function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return r}));var r={uIcon:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(i.bind(null,"1e79"))},uForm:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-form/u-form")]).then(i.bind(null,"ff33"))},myCard:function(){return i.e("components/my-card").then(i.bind(null,"2227"))},uFormItem:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(i.bind(null,"f4f7"))},uInput:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-input/u-input")]).then(i.bind(null,"f18a"))},uButton:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-button/u-button")]).then(i.bind(null,"2e7d"))},uTag:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-tag/u-tag")]).then(i.bind(null,"2f47"))},"u-Textarea":function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u--textarea/u--textarea")]).then(i.bind(null,"433b"))},myUpload:function(){return Promise.all([i.e("common/vendor"),i.e("components/my-upload")]).then(i.bind(null,"efc5"))},uRadioGroup:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-radio-group/u-radio-group")]).then(i.bind(null,"9f38"))},uRadio:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-radio/u-radio")]).then(i.bind(null,"082a"))},myTimeAxis:function(){return i.e("components/my-time-axis").then(i.bind(null,"405c"))},uAvatar:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-avatar/u-avatar")]).then(i.bind(null,"b1e7"))},myButton:function(){return i.e("components/my-button").then(i.bind(null,"e84c"))},uActionSheet:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-action-sheet/u-action-sheet")]).then(i.bind(null,"ff2a"))},uDatetimePicker:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-datetime-picker/u-datetime-picker")]).then(i.bind(null,"2990"))},wPicker:function(){return i.e("components/w-picker/w-picker").then(i.bind(null,"c33c"))},uOverlay:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-overlay/u-overlay")]).then(i.bind(null,"3776"))},uToast:function(){return i.e("uni_modules/uview-ui/components/u-toast/u-toast").then(i.bind(null,"b688"))}},o=function(){var e=this,t=e.$createElement,i=(e._self._c,4==e.receiptType?Array.isArray(e.bkTimeSteps)&&e.bkTimeSteps.length>0:null),r=4==e.receiptType?Array.isArray(e.bkTimeSteps)&&e.bkTimeSteps.length<=e.cardCountMax-1:null,o=Array.isArray(e.jbTimeTabel)&&e.jbTimeTabel.length>0&&3==e.receiptType,s={token:e.vuex_urlobj.token,sid:e.vuex_urlobj.sid},n=e.form.empName?e.form.empName&&e.form.empName.substr(e.form.empName.length-2):null,m=e.form.auditEmpIds?e.form.auditEmpName&&e.form.auditEmpName.substr(e.form.auditEmpName.length-2):null,a=Array.isArray(e.duplicateEmpList)&&e.duplicateEmpList.length>0,c=e.__map(e.duplicateEmpList,(function(t,i){var r=e.__get_orig(t),o=a?t.empName&&t.empName.substr(t.empName.length-2):null;return{$orig:r,g6:o}})),u=new Date("2050/05/31").getTime(),p=3!=e.receiptType?new Date("2050/05/31").getTime():null;e._isMounted||(e.e0=function(t){e.typeRoleShow=!0},e.e1=function(t){e.cityShow=!0,e.btnType="from"},e.e2=function(t){e.cityShow=!0,e.btnType="toCity"},e.e3=function(t){e.startTimeShow=!0},e.e4=function(t){e.startTimeShow=!0},e.e5=function(t){e.typeRoleShow=!1},e.e6=function(t){e.startTimeShow=!1},e.e7=function(t){e.startTimeShow=!1},e.e8=function(t){e.endTimeShow=!1},e.e9=function(t){e.endTimeShow=!1}),e.$mp.data=Object.assign({},{$root:{g0:i,g1:r,g2:o,a0:s,g3:n,g4:m,g5:a,l0:c,g7:u,g8:p}})},s=[]},da9b:function(e,t,i){}},[["b9bb","common/runtime","common/vendor","pageKq/common/vendor"]]]);